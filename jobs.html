<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>HR Panel – Pelamar</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',sans-serif}
body{display:flex;background:#f3f4f6;color:#111827;min-height:100vh}

/* SIDEBAR */
.sidebar{width:240px;background:#0f172a;color:#fff;padding:24px}
.sidebar h2{margin-bottom:30px}
.menu a,.menu button{
  display:block;width:100%;background:none;border:none;
  color:#cbd5f5;text-decoration:none;padding:12px;
  border-radius:10px;margin-bottom:6px;cursor:pointer;text-align:left
}
.menu a.active,.menu a:hover,.menu button:hover{
  background:#1e293b;color:#fff
}

/* MAIN */
.main{flex:1;padding:30px}
.card{
  background:#fff;border-radius:16px;padding:24px;
  box-shadow:0 10px 20px rgba(0,0,0,.08)
}

table{width:100%;border-collapse:collapse}
th,td{padding:14px;border-bottom:1px solid #e5e7eb;text-align:left}
th{font-size:.8rem;color:#6b7280}

.btn{
  padding:8px 12px;border-radius:8px;border:none;
  background:#2563eb;color:#fff;cursor:pointer
}
.btn.secondary{background:#64748b}
.btn.danger{background:#dc2626}

/* MODAL */
.modal{
  position:fixed;inset:0;background:rgba(0,0,0,.5);
  display:none;align-items:center;justify-content:center;z-index:50
}
.modal.active{display:flex}
.modal-box{
  background:#fff;border-radius:16px;padding:24px;
  width:100%;max-width:480px
}
.modal-header{
  display:flex;justify-content:space-between;align-items:center;margin-bottom:12px
}
.close{border:none;background:none;font-size:1.5rem;cursor:pointer}
</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
  <h2>HR Panel</h2>
  <div class="menu">
    <a href="dashboard.html">Dashboard</a>
    <a href="hr-lowongan.html">Lowongan</a>
    <a class="active">Pelamar</a>
    <button id="logoutBtn">Logout</button>
  </div>
</div>

<!-- MAIN -->
<div class="main">
<div class="card">
<h3>Daftar Pelamar</h3>

<table>
<thead>
<tr>
  <th>Nama</th>
  <th>Email</th>
  <th>Posisi</th>
  <th>Tanggal</th>
  <th>Aksi</th>
</tr>
</thead>
<tbody id="applicantsTable"></tbody>
</table>

</div>
</div>

<!-- MODAL DETAIL -->
<div class="modal" id="detailModal">
  <div class="modal-box">
    <div class="modal-header">
      <h3>Detail Pelamar</h3>
      <button class="close" onclick="detailModal.classList.remove('active')">×</button>
    </div>
    <p><b>Nama:</b> <span id="dName"></span></p>
    <p><b>Email:</b> <span id="dEmail"></span></p>
    <p><b>Telepon:</b> <span id="dPhone"></span></p>
    <p><b>Posisi:</b> <span id="dJob"></span></p>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  getFirestore, collection, getDocs, deleteDoc, doc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyCdi_d9l8azfwgeFoB8aF7RdUvgcaexQu0",
  authDomain: "career-portal-ace63.firebaseapp.com",
  projectId: "career-portal-ace63"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ELEMENT */
const table = document.getElementById("applicantsTable");
const detailModal = document.getElementById("detailModal");

const dName = document.getElementById("dName");
const dEmail = document.getElementById("dEmail");
const dPhone = document.getElementById("dPhone");
const dJob = document.getElementById("dJob");

/* LOAD APPLICANTS */
async function loadApplicants(){
  table.innerHTML = "<tr><td colspan='5'>Loading...</td></tr>";

  const snap = await getDocs(collection(db,"applicants"));
  table.innerHTML = "";

  snap.forEach(d=>{
    const a = d.data();
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${a.name}</td>
      <td>${a.email}</td>
      <td>${a.jobTitle}</td>
      <td>${a.createdAt?.toDate().toLocaleDateString()}</td>
      <td></td>
    `;

    const detailBtn = document.createElement("button");
    detailBtn.className = "btn secondary";
    detailBtn.innerText = "Detail";
    detailBtn.onclick = ()=>{
      dName.innerText = a.name;
      dEmail.innerText = a.email;
      dPhone.innerText = a.phone || "-";
      dJob.innerText = a.jobTitle;
      detailModal.classList.add("active");
    };

    const delBtn = document.createElement("button");
    delBtn.className = "btn danger";
    delBtn.innerText = "Hapus";
    delBtn.onclick = async ()=>{
      if(confirm("Hapus pelamar ini?")){
        await deleteDoc(doc(db,"applicants",d.id));
        loadApplicants();
      }
    };

    tr.children[4].append(detailBtn, delBtn);
    table.appendChild(tr);
  });
}

/* LOGOUT */
logoutBtn.onclick = async ()=>{
  await signOut(auth);
  location.href = "login.html";
};

loadApplicants();
</script>

</body>
</html>
